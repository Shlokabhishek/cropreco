<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Recommender - Complete System Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* Cover Page */
        .cover-page {
            text-align: center;
            padding: 80px 20px;
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            margin: -40px -40px 40px -40px;
            border-radius: 0;
        }
        
        .cover-page h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .cover-page .subtitle {
            font-size: 1.5em;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .cover-page .version {
            font-size: 1em;
            opacity: 0.8;
        }
        
        /* Table of Contents */
        .toc {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 8px;
            margin: 30px 0;
        }
        
        .toc h2 {
            color: #2e7d32;
            border-bottom: 2px solid #2e7d32;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .toc ul {
            list-style: none;
        }
        
        .toc li {
            padding: 8px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .toc li:last-child {
            border-bottom: none;
        }
        
        .toc a {
            color: #1565c0;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .toc .section-num {
            display: inline-block;
            width: 40px;
            font-weight: bold;
            color: #2e7d32;
        }
        
        /* Section Headers */
        h2 {
            color: #2e7d32;
            font-size: 2em;
            margin: 50px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #2e7d32;
        }
        
        h3 {
            color: #1565c0;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }
        
        h4 {
            color: #555;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }
        
        /* Code Blocks */
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            margin: 15px 0;
            line-height: 1.5;
        }
        
        code {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        /* Syntax Highlighting */
        .keyword { color: #569cd6; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; }
        .function { color: #dcdcaa; }
        .type { color: #4ec9b0; }
        .number { color: #b5cea8; }
        
        /* Flowcharts */
        .flowchart {
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.4;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #2e7d32;
            color: white;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        /* Info Boxes */
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #1565c0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #f57c00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #2e7d32;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        /* Architecture Diagrams */
        .architecture {
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.3;
            font-size: 0.85em;
        }
        
        /* Lists */
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 8px 0;
        }
        
        /* Page Break for printing */
        .page-break {
            page-break-before: always;
        }
        
        /* Feature Cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .feature-card h4 {
            color: #2e7d32;
            margin-top: 0;
        }
        
        /* Tech Stack */
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .tech-badge {
            background: #2e7d32;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 20px;
            }
            
            .cover-page {
                margin: -20px -20px 20px -20px;
            }
            
            pre, .flowchart, .architecture {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Cover Page -->
        <div class="cover-page">
            <h1>ğŸŒ¾ Crop Recommender System</h1>
            <p class="subtitle">Complete System Documentation</p>
            <p class="subtitle">Architecture, Algorithms, Code & Flowcharts</p>
            <p class="version">Version 1.2 | February 2026</p>
            <p class="version">Full-Stack React + Node.js Application</p>
        </div>

        <!-- Table of Contents -->
        <div class="toc">
            <h2>ğŸ“‘ Table of Contents</h2>
            <ul>
                <li><span class="section-num">1.</span> <a href="#overview">System Overview</a></li>
                <li><span class="section-num">2.</span> <a href="#architecture">System Architecture</a></li>
                <li><span class="section-num">3.</span> <a href="#tech-stack">Technology Stack</a></li>
                <li><span class="section-num">4.</span> <a href="#database">Database Schema</a></li>
                <li><span class="section-num">5.</span> <a href="#flowcharts">Data Flow Diagrams</a></li>
                <li><span class="section-num">6.</span> <a href="#api">API Architecture</a></li>
                <li><span class="section-num">7.</span> <a href="#algorithms">Recommendation Algorithms (WMFS)</a>
                    <ul style="margin-left: 20px; margin-top: 5px; font-size: 0.9em;">
                        <li>7.1 Algorithm Overview: How WMFS Recommends Crops</li>
                        <li>7.2 Mathematical Formulae (8 Core Equations)</li>
                        <li>7.3 Detailed Scoring Formula</li>
                        <li>7.4 Economic Calculations</li>
                        <li>7.5 Filtering Strategy</li>
                        <li>7.6 Farming Type Scoring Algorithms</li>
                        <li>7.7 Intercropping & Multiple Crops Algorithm</li>
                        <li>7.8 Crops to Avoid Algorithm (Risk Assessment)</li>
                        <li>7.9 Live Market Price Integration</li>
                    </ul>
                </li>
                <li><span class="section-num">8.</span> <a href="#code-snippets">Key Code Snippets</a></li>
                <li><span class="section-num">9.</span> <a href="#security">Security Architecture</a></li>
                <li><span class="section-num">10.</span> <a href="#deployment">Deployment Guide</a></li>
                <li><span class="section-num">11.</span> <a href="#testing">Testing Guide</a></li>
                <li><span class="section-num">12.</span> <a href="#features">Features Summary</a></li>
            </ul>
        </div>

        <!-- Section 1: System Overview -->
        <h2 id="overview">1. System Overview</h2>
        
        <p>The Crop Recommender System is a comprehensive full-stack web application designed to help farmers make informed decisions about crop selection. The system analyzes multiple factors including soil type, weather patterns, market trends, and historical data to provide personalized crop recommendations.</p>

        <div class="feature-grid">
            <div class="feature-card">
                <h4>ğŸ” Authentication</h4>
                <p>Secure JWT-based login/registration system with bcrypt password hashing</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ‘¤ Farmer Profiles</h4>
                <p>Comprehensive profiles with location, soil quality, acreage, and crop history</p>
            </div>
            <div class="feature-card">
                <h4>ğŸŒ¤ï¸ Weather Integration</h4>
                <p>Real-time weather data and 7-day forecasts via OpenWeather API</p>
            </div>
            <div class="feature-card">
                <h4>ğŸŒ¾ Crop Recommendations</h4>
                <p>AI-powered suggestions based on soil, weather, and market conditions</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ’° Price Analysis</h4>
                <p>Market price trends, comparisons, and actionable recommendations</p>
            </div>
            <div class="feature-card">
                <h4>ğŸ“Š Data Visualization</h4>
                <p>Interactive charts for weather, prices, and recommendations</p>
            </div>
        </div>

        <!-- Section 2: System Architecture -->
        <h2 id="architecture" class="page-break">2. System Architecture</h2>
        
        <h3>2.1 High-Level Architecture Diagram</h3>
        
        <div class="architecture">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                            â”‚
â”‚                     http://localhost:5173                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP/HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REACT FRONTEND (Vite)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Components: Auth, Profile, Recommendations, Weather...   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  State Management (Redux): auth, crop, market, user...   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Services: api.ts (Backend Integration)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ REST API (JWT Auth)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EXPRESS.JS BACKEND API                        â”‚
â”‚                   http://localhost:3001/api                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Middleware: CORS, Auth (JWT), Error Handler             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Routes:                                                  â”‚  â”‚
â”‚  â”‚    â€¢ /auth       â†’ Registration, Login                   â”‚  â”‚
â”‚  â”‚    â€¢ /crops      â†’ Recommendations, History              â”‚  â”‚
â”‚  â”‚    â€¢ /weather    â†’ Current, Forecast                     â”‚  â”‚
â”‚  â”‚    â€¢ /market     â†’ Prices, Trends, Comparison            â”‚  â”‚
â”‚  â”‚    â€¢ /users      â†’ Profile, Crop History                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â”‚                    â”‚                    â”‚
           â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQLite Database â”‚  â”‚  CSV Datasets    â”‚  â”‚  External APIs   â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚ â€¢ users          â”‚  â”‚ â€¢ crop_dataset   â”‚  â”‚ â€¢ OpenWeather    â”‚
â”‚ â€¢ farmer_profilesâ”‚  â”‚ â€¢ soil_dataset   â”‚  â”‚   API            â”‚
â”‚ â€¢ crop_history   â”‚  â”‚                  â”‚  â”‚ â€¢ AGMARKNET      â”‚
â”‚ â€¢ market_prices  â”‚  â”‚                  â”‚  â”‚   (Govt)         â”‚
â”‚ â€¢ recommendationsâ”‚  â”‚                  â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>2.2 Project Directory Structure</h3>
        
        <pre><code>crop-recommender/
â”œâ”€â”€ src/                          # Frontend Source
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Auth/                 # Login/Registration + Google OAuth
â”‚   â”‚   â”œâ”€â”€ CropRecommendations/  # Crop suggestions
â”‚   â”‚   â”œâ”€â”€ CropsToAvoid/         # Risk analysis - crops to avoid
â”‚   â”‚   â”œâ”€â”€ FarmerProfile/        # User profile management
â”‚   â”‚   â”œâ”€â”€ LanguageSelector/     # Multi-language dropdown
â”‚   â”‚   â”œâ”€â”€ MarketTrends/         # Market data display
â”‚   â”‚   â”œâ”€â”€ PriceAnalysis/        # Price charts & analysis
â”‚   â”‚   â”œâ”€â”€ SoilSuitability/      # Soil compatibility
â”‚   â”‚   â”œâ”€â”€ WeatherTrends/        # Weather forecasts
â”‚   â”‚   â””â”€â”€ shared/               # Reusable UI components
â”‚   â”œâ”€â”€ i18n/                     # Internationalization
â”‚   â”‚   â”œâ”€â”€ translations.ts       # 10 Indian languages
â”‚   â”‚   â””â”€â”€ LanguageContext.tsx   # Language state provider
â”‚   â”œâ”€â”€ hooks/                    # Custom React hooks
â”‚   â”œâ”€â”€ pages/                    # Page components
â”‚   â”œâ”€â”€ services/                 # API service layer
â”‚   â”‚   â”œâ”€â”€ api.ts                # Backend API integration
â”‚   â”‚   â”œâ”€â”€ firebase.ts           # Google OAuth configuration
â”‚   â”‚   â”œâ”€â”€ recommender.ts        # Recommendation engine
â”‚   â”‚   â””â”€â”€ weather.ts            # Weather utilities
â”‚   â”œâ”€â”€ state/                    # Redux store & slices
â”‚   â””â”€â”€ data/                     # CSV datasets
â”œâ”€â”€ server/                       # Backend Source
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts              # Express server entry
â”‚   â”‚   â”œâ”€â”€ routes/               # API route handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ authRoutes.ts     # Authentication
â”‚   â”‚   â”‚   â”œâ”€â”€ cropRoutes.ts     # Crop endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ marketRoutes.ts   # Market data
â”‚   â”‚   â”‚   â”œâ”€â”€ userRoutes.ts     # User management
â”‚   â”‚   â”‚   â””â”€â”€ weatherRoutes.ts  # Weather API
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ database.ts       # SQLite configuration
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â”œâ”€â”€ auth.ts           # JWT middleware
â”‚   â”‚       â””â”€â”€ errorHandler.ts   # Error handling
â”‚   â”œâ”€â”€ data/                     # SQLite database
â”‚   â””â”€â”€ package.json              # Backend dependencies
â”œâ”€â”€ public/                       # Static assets
â”‚   â””â”€â”€ data/                     # CSV datasets
â””â”€â”€ package.json                  # Root dependencies</code></pre>

        <!-- Section 3: Technology Stack -->
        <h2 id="tech-stack" class="page-break">3. Technology Stack</h2>
        
        <h3>3.1 Frontend Technologies</h3>
        
        <div class="tech-stack">
            <span class="tech-badge">React 18</span>
            <span class="tech-badge">TypeScript 5.9</span>
            <span class="tech-badge">Redux Toolkit</span>
            <span class="tech-badge">Vite 7.3</span>
            <span class="tech-badge">Firebase Auth</span>
            <span class="tech-badge">i18n (10 Languages)</span>
            <span class="tech-badge">Recharts</span>
            <span class="tech-badge">Plotly.js</span>
            <span class="tech-badge">TensorFlow.js</span>
        </div>

        <table>
            <tr>
                <th>Technology</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td>React</td>
                <td>18.3.1</td>
                <td>UI Framework, Component-based architecture</td>
            </tr>
            <tr>
                <td>TypeScript</td>
                <td>5.9.3</td>
                <td>Type safety, IDE support, compile-time checking</td>
            </tr>
            <tr>
                <td>Redux Toolkit</td>
                <td>1.9.7</td>
                <td>Centralized state management</td>
            </tr>
            <tr>
                <td>Firebase</td>
                <td>10.7.1</td>
                <td>Google OAuth authentication</td>
            </tr>
            <tr>
                <td>Vite</td>
                <td>7.3.1</td>
                <td>Fast dev server, optimized builds, HMR</td>
            </tr>
            <tr>
                <td>TensorFlow.js</td>
                <td>4.22.0</td>
                <td>ML-powered recommendations</td>
            </tr>
            <tr>
                <td>Recharts/Plotly</td>
                <td>3.6.0/3.3.1</td>
                <td>Data visualization, interactive charts</td>
            </tr>
        </table>

        <h3>3.2 Backend Technologies</h3>

        <div class="tech-stack">
            <span class="tech-badge">Node.js 18+</span>
            <span class="tech-badge">Express.js 4.18</span>
            <span class="tech-badge">SQLite3</span>
            <span class="tech-badge">JWT</span>
            <span class="tech-badge">bcrypt</span>
            <span class="tech-badge">Axios</span>
        </div>

        <table>
            <tr>
                <th>Technology</th>
                <th>Version</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td>Node.js</td>
                <td>18+</td>
                <td>Runtime environment, Async I/O</td>
            </tr>
            <tr>
                <td>Express.js</td>
                <td>4.18.2</td>
                <td>REST API framework, middleware, routing</td>
            </tr>
            <tr>
                <td>SQLite3</td>
                <td>5.1.7</td>
                <td>Embedded database, file-based storage</td>
            </tr>
            <tr>
                <td>jsonwebtoken</td>
                <td>9.0.2</td>
                <td>JWT token generation/verification</td>
            </tr>
            <tr>
                <td>bcrypt</td>
                <td>5.1.1</td>
                <td>Password hashing (10 salt rounds)</td>
            </tr>
            <tr>
                <td>csv-parse</td>
                <td>5.5.5</td>
                <td>CSV data processing</td>
            </tr>
        </table>

        <!-- Section 4: Database Schema -->
        <h2 id="database" class="page-break">4. Database Schema</h2>
        
        <h3>4.1 Entity Relationship Diagram</h3>

        <div class="architecture">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASE SCHEMA                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

users
â”œâ”€â”€ id (PRIMARY KEY, AUTOINCREMENT)
â”œâ”€â”€ email (UNIQUE, NOT NULL)
â”œâ”€â”€ password_hash (NOT NULL)
â”œâ”€â”€ name (NOT NULL)
â””â”€â”€ created_at (DEFAULT CURRENT_TIMESTAMP)
     â”‚
     â”‚ 1:1
     â–¼
farmer_profiles
â”œâ”€â”€ id (PRIMARY KEY)
â”œâ”€â”€ user_id (FOREIGN KEY â†’ users.id)
â”œâ”€â”€ state (NOT NULL)
â”œâ”€â”€ district
â”œâ”€â”€ acreage (NOT NULL)
â”œâ”€â”€ soil_type (NOT NULL)
â”œâ”€â”€ budget
â”œâ”€â”€ phone
â”œâ”€â”€ created_at
â””â”€â”€ updated_at
     â”‚
     â”‚ 1:many
     â–¼
crop_history                                recommendations
â”œâ”€â”€ id (PRIMARY KEY)                        â”œâ”€â”€ id (PRIMARY KEY)
â”œâ”€â”€ user_id (FK â†’ users.id)                 â”œâ”€â”€ user_id (FK â†’ users.id)
â”œâ”€â”€ crop_name (NOT NULL)                    â”œâ”€â”€ crop_name (NOT NULL)
â”œâ”€â”€ season (NOT NULL)                       â”œâ”€â”€ score (NOT NULL)
â”œâ”€â”€ year (NOT NULL)                         â”œâ”€â”€ estimated_yield
â”œâ”€â”€ yield_actual                            â”œâ”€â”€ estimated_revenue
â”œâ”€â”€ revenue                                 â”œâ”€â”€ season
â”œâ”€â”€ notes                                   â”œâ”€â”€ parameters (JSON)
â””â”€â”€ created_at                              â””â”€â”€ created_at

market_prices (independent table)
â”œâ”€â”€ id (PRIMARY KEY)
â”œâ”€â”€ commodity (NOT NULL)
â”œâ”€â”€ price (NOT NULL)
â”œâ”€â”€ unit (DEFAULT 'per quintal')
â”œâ”€â”€ market_name
â”œâ”€â”€ state
â”œâ”€â”€ date (NOT NULL)
â”œâ”€â”€ source (DEFAULT 'government')
â””â”€â”€ created_at
        </div>

        <h3>4.2 SQL Schema Definition</h3>

        <pre><code><span class="comment">-- Users table for authentication</span>
<span class="keyword">CREATE TABLE IF NOT EXISTS</span> users (
    id <span class="type">INTEGER PRIMARY KEY AUTOINCREMENT</span>,
    email <span class="type">TEXT UNIQUE NOT NULL</span>,
    password_hash <span class="type">TEXT NOT NULL</span>,
    name <span class="type">TEXT NOT NULL</span>,
    created_at <span class="type">DATETIME DEFAULT CURRENT_TIMESTAMP</span>
);

<span class="comment">-- Farmer profiles linked to users</span>
<span class="keyword">CREATE TABLE IF NOT EXISTS</span> farmer_profiles (
    id <span class="type">INTEGER PRIMARY KEY AUTOINCREMENT</span>,
    user_id <span class="type">INTEGER NOT NULL</span>,
    state <span class="type">TEXT NOT NULL</span>,
    district <span class="type">TEXT</span>,
    acreage <span class="type">REAL NOT NULL</span>,
    soil_type <span class="type">TEXT NOT NULL</span>,
    budget <span class="type">REAL</span>,
    phone <span class="type">TEXT</span>,
    created_at <span class="type">DATETIME DEFAULT CURRENT_TIMESTAMP</span>,
    updated_at <span class="type">DATETIME DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON DELETE CASCADE</span>
);

<span class="comment">-- Crop history for tracking past harvests</span>
<span class="keyword">CREATE TABLE IF NOT EXISTS</span> crop_history (
    id <span class="type">INTEGER PRIMARY KEY AUTOINCREMENT</span>,
    user_id <span class="type">INTEGER NOT NULL</span>,
    crop_name <span class="type">TEXT NOT NULL</span>,
    season <span class="type">TEXT NOT NULL</span>,
    year <span class="type">INTEGER NOT NULL</span>,
    yield_actual <span class="type">REAL</span>,
    revenue <span class="type">REAL</span>,
    notes <span class="type">TEXT</span>,
    created_at <span class="type">DATETIME DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON DELETE CASCADE</span>
);

<span class="comment">-- Market prices for commodities</span>
<span class="keyword">CREATE TABLE IF NOT EXISTS</span> market_prices (
    id <span class="type">INTEGER PRIMARY KEY AUTOINCREMENT</span>,
    commodity <span class="type">TEXT NOT NULL</span>,
    price <span class="type">REAL NOT NULL</span>,
    unit <span class="type">TEXT DEFAULT 'per quintal'</span>,
    market_name <span class="type">TEXT</span>,
    state <span class="type">TEXT</span>,
    date <span class="type">DATE NOT NULL</span>,
    source <span class="type">TEXT DEFAULT 'government'</span>,
    created_at <span class="type">DATETIME DEFAULT CURRENT_TIMESTAMP</span>
);

<span class="comment">-- Saved recommendations</span>
<span class="keyword">CREATE TABLE IF NOT EXISTS</span> recommendations (
    id <span class="type">INTEGER PRIMARY KEY AUTOINCREMENT</span>,
    user_id <span class="type">INTEGER NOT NULL</span>,
    crop_name <span class="type">TEXT NOT NULL</span>,
    score <span class="type">REAL NOT NULL</span>,
    estimated_yield <span class="type">REAL</span>,
    estimated_revenue <span class="type">REAL</span>,
    season <span class="type">TEXT</span>,
    parameters <span class="type">TEXT</span>,
    created_at <span class="type">DATETIME DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON DELETE CASCADE</span>
);

<span class="comment">-- Performance indexes</span>
<span class="keyword">CREATE INDEX IF NOT EXISTS</span> idx_market_prices_commodity <span class="keyword">ON</span> market_prices(commodity);
<span class="keyword">CREATE INDEX IF NOT EXISTS</span> idx_market_prices_date <span class="keyword">ON</span> market_prices(date);
<span class="keyword">CREATE INDEX IF NOT EXISTS</span> idx_crop_history_user <span class="keyword">ON</span> crop_history(user_id);
<span class="keyword">CREATE INDEX IF NOT EXISTS</span> idx_recommendations_user <span class="keyword">ON</span> recommendations(user_id);</code></pre>

        <!-- Section 5: Data Flow Diagrams -->
        <h2 id="flowcharts" class="page-break">5. Data Flow Diagrams</h2>
        
        <h3>5.1 User Authentication Flow</h3>

        <div class="flowchart">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Opens    â”‚
â”‚   Application   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Has Account?   â”‚â”€â”€NOâ”€â”€â–¶â”‚   Register      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   Form          â”‚
         â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        YES                       â”‚
         â”‚                        â–¼
         â–¼               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ POST /api/auth/ â”‚
â”‚   Login Form    â”‚      â”‚   register      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/ â”‚      â”‚ Hash Password   â”‚
â”‚     login       â”‚      â”‚ (bcrypt x10)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate        â”‚      â”‚ Store in DB     â”‚
â”‚ Credentials     â”‚      â”‚ (users table)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate JWT    â”‚â—€â”€â”€â”€â”€â”€â”‚ Generate JWT    â”‚
â”‚ (7 day expiry)  â”‚      â”‚ (7 day expiry)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Store Token in  â”‚
         â”‚ localStorage    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Redirect to     â”‚
         â”‚ Dashboard       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>5.2 Crop Recommendation Flow</h3>

        <div class="flowchart">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CROP RECOMMENDATION FLOW                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Submits    â”‚
â”‚ Profile Data    â”‚
â”‚ â€¢ State         â”‚
â”‚ â€¢ Acreage       â”‚
â”‚ â€¢ Soil Type     â”‚
â”‚ â€¢ Season        â”‚
â”‚ â€¢ Rainfall      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend calls  â”‚
â”‚ POST /api/crops â”‚
â”‚ /recommend      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auth Middleware â”‚
â”‚ Verify JWT      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load & Parse    â”‚
â”‚ crop_dataset.csvâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MULTI-LEVEL FILTERING                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Level 1: Filter by State                                  â”‚  â”‚
â”‚  â”‚ Level 2: Filter by Season                                 â”‚  â”‚
â”‚  â”‚ Level 3: Match Soil Type                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SCORING ALGORITHM                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Base Score: 50 points                                     â”‚  â”‚
â”‚  â”‚ + Rainfall Match: up to 25 points                         â”‚  â”‚
â”‚  â”‚ + Soil Compatibility: 15 points                           â”‚  â”‚
â”‚  â”‚ + Market Price Factor: variable                           â”‚  â”‚
â”‚  â”‚ = Final Score (0-100)                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate for   â”‚      â”‚ Calculate for   â”‚
â”‚ Each Crop:      â”‚      â”‚ Total:          â”‚
â”‚ â€¢ Yield/Hectare â”‚      â”‚ â€¢ Hectares      â”‚
â”‚ â€¢ Market Price  â”‚      â”‚ â€¢ Est. Yield    â”‚
â”‚ â€¢ Cost Factors  â”‚      â”‚ â€¢ Est. Revenue  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sort by Score   â”‚
â”‚ Return Top 10   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Save Top 3 to   â”‚
â”‚ recommendations â”‚
â”‚ table           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return JSON to  â”‚
â”‚ Frontend        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display in      â”‚
â”‚ CropRecommenda- â”‚
â”‚ tions Component â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>5.3 Weather Data Flow</h3>

        <div class="flowchart">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Location   â”‚
â”‚ from Profile    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/weatherâ”‚
â”‚ /current?       â”‚
â”‚ location=Mumbai â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check for       â”‚
â”‚ OPENWEATHER_    â”‚
â”‚ API_KEY         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
   YES       NO
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Call    â”‚ â”‚ Generate    â”‚
â”‚OpenWeatherâ”‚ â”‚ Mock Data  â”‚
â”‚ API     â”‚ â”‚ (realistic) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚
     â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parse & â”‚ â”‚ Return:     â”‚
â”‚ Format  â”‚ â”‚ â€¢ temp      â”‚
â”‚ Responseâ”‚ â”‚ â€¢ humidity  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â€¢ rainfall  â”‚
     â”‚      â”‚ â€¢ condition â”‚
     â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return Weather  â”‚
â”‚ JSON to Frontendâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display in      â”‚
â”‚ WeatherTrends   â”‚
â”‚ Component       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>5.4 Market Price Flow</h3>

        <div class="flowchart">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Selects    â”‚
â”‚ Commodity       â”‚
â”‚ (e.g., Rice)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/market â”‚
â”‚ /prices/rice?   â”‚
â”‚ state=Maharashtraâ”‚
â”‚ &days=30        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query           â”‚
â”‚ market_prices   â”‚
â”‚ table           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Filter by:      â”‚
â”‚ â€¢ Commodity     â”‚
â”‚ â€¢ State         â”‚
â”‚ â€¢ Date Range    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
 Found     Not Found
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return  â”‚ â”‚ Generate    â”‚
â”‚ Actual  â”‚ â”‚ Mock Prices â”‚
â”‚ Data    â”‚ â”‚ with Trend  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate Trendsâ”‚
â”‚ â€¢ Uptrend â†‘     â”‚
â”‚ â€¢ Downtrend â†“   â”‚
â”‚ â€¢ Stable â†’      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display Charts  â”‚
â”‚ in PriceAnalysisâ”‚
â”‚ Component       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <!-- Section 6: API Architecture -->
        <h2 id="api" class="page-break">6. API Architecture</h2>
        
        <h3>6.1 API Route Structure</h3>

        <div class="architecture">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API STRUCTURE                                â”‚
â”‚                                                                 â”‚
â”‚  Base URL: http://localhost:3001/api                           â”‚
â”‚                                                                 â”‚
â”‚  /api                                                          â”‚
â”‚  â”œâ”€â”€ /auth            (Public)                                 â”‚
â”‚  â”‚   â”œâ”€â”€ POST /register    â†’ Create user account               â”‚
â”‚  â”‚   â””â”€â”€ POST /login       â†’ Authenticate & get token          â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ /crops           (Mixed)                                  â”‚
â”‚  â”‚   â”œâ”€â”€ GET  /            (Public)  â†’ All crops               â”‚
â”‚  â”‚   â”œâ”€â”€ GET  /:name       (Public)  â†’ Specific crop           â”‚
â”‚  â”‚   â”œâ”€â”€ POST /recommend   (Protected) ğŸ”’ â†’ Get recommendationsâ”‚
â”‚  â”‚   â””â”€â”€ GET  /history/user(Protected) ğŸ”’ â†’ User history       â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ /weather         (Public)                                 â”‚
â”‚  â”‚   â”œâ”€â”€ GET /current      â†’ Current weather                   â”‚
â”‚  â”‚   â””â”€â”€ GET /forecast     â†’ 7-day forecast                    â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”œâ”€â”€ /market          (Mixed)                                  â”‚
â”‚  â”‚   â”œâ”€â”€ GET  /prices/:commodity   (Public)   â†’ Price history  â”‚
â”‚  â”‚   â”œâ”€â”€ GET  /commodities         (Public)   â†’ List all       â”‚
â”‚  â”‚   â”œâ”€â”€ GET  /trends              (Public)   â†’ Price trends   â”‚
â”‚  â”‚   â”œâ”€â”€ GET  /comparison/:commodity (Public) â†’ State compare  â”‚
â”‚  â”‚   â””â”€â”€ POST /prices              (Admin) ğŸ”’ â†’ Add price      â”‚
â”‚  â”‚                                                             â”‚
â”‚  â””â”€â”€ /users           (All Protected) ğŸ”’                       â”‚
â”‚      â”œâ”€â”€ GET    /profile           â†’ Get user profile          â”‚
â”‚      â”œâ”€â”€ POST   /profile/farmer    â†’ Update farmer profile     â”‚
â”‚      â”œâ”€â”€ GET    /history/crops     â†’ Get crop history          â”‚
â”‚      â”œâ”€â”€ POST   /history/crops     â†’ Add crop history          â”‚
â”‚      â””â”€â”€ DELETE /history/crops/:id â†’ Delete history entry      â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”’ = Requires JWT token in Authorization header               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>6.2 Complete API Reference</h3>

        <h4>Authentication Endpoints</h4>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Description</th>
                <th>Request Body</th>
            </tr>
            <tr>
                <td><code>POST</code></td>
                <td>/api/auth/register</td>
                <td>Register new user</td>
                <td><code>{ email, password, name }</code></td>
            </tr>
            <tr>
                <td><code>POST</code></td>
                <td>/api/auth/login</td>
                <td>Login and get JWT</td>
                <td><code>{ email, password }</code></td>
            </tr>
        </table>

        <h4>Crop Endpoints</h4>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Auth</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/crops</td>
                <td>No</td>
                <td>Get all crops from dataset</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/crops/:name</td>
                <td>No</td>
                <td>Get specific crop details</td>
            </tr>
            <tr>
                <td><code>POST</code></td>
                <td>/api/crops/recommend</td>
                <td>Yes</td>
                <td>Get personalized recommendations</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/crops/history/user</td>
                <td>Yes</td>
                <td>Get user's recommendation history</td>
            </tr>
        </table>

        <h4>Weather Endpoints</h4>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Query Params</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/weather/current</td>
                <td>location, lat, lon</td>
                <td>Current weather conditions</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/weather/forecast</td>
                <td>location, days (default: 7)</td>
                <td>Weather forecast</td>
            </tr>
        </table>

        <h4>Market Endpoints</h4>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Query Params</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/market/prices/:commodity</td>
                <td>state, days</td>
                <td>Get commodity prices</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/market/commodities</td>
                <td>-</td>
                <td>List all commodities</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/market/trends</td>
                <td>commodities, days</td>
                <td>Price trends analysis</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/market/comparison/:commodity</td>
                <td>-</td>
                <td>Compare across states</td>
            </tr>
        </table>

        <h4>User Endpoints (All require authentication)</h4>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/users/profile</td>
                <td>Get current user's profile</td>
            </tr>
            <tr>
                <td><code>POST</code></td>
                <td>/api/users/profile/farmer</td>
                <td>Create/update farmer profile</td>
            </tr>
            <tr>
                <td><code>GET</code></td>
                <td>/api/users/history/crops</td>
                <td>Get crop history</td>
            </tr>
            <tr>
                <td><code>POST</code></td>
                <td>/api/users/history/crops</td>
                <td>Add new crop history entry</td>
            </tr>
            <tr>
                <td><code>DELETE</code></td>
                <td>/api/users/history/crops/:id</td>
                <td>Delete history entry</td>
            </tr>
        </table>

        <!-- Section 7: Recommendation Algorithms -->
        <h2 id="algorithms" class="page-break">7. Recommendation Algorithms</h2>

        <div class="success-box">
            <h3 style="margin-top: 0; color: #1b5e20;">ğŸ§® Algorithm Name: Weighted Multi-Factor Scoring Algorithm (WMFS)</h3>
            <p>The Crop Recommender System uses a <strong>Weighted Multi-Factor Scoring Algorithm (WMFS)</strong> - a hybrid decision-support algorithm that combines:</p>
            <ul>
                <li><strong>Multi-Criteria Decision Analysis (MCDA)</strong> - Evaluates crops against multiple weighted criteria</li>
                <li><strong>Cost-Benefit Analysis (CBA)</strong> - Calculates ROI, profit margins, and economic viability</li>
                <li><strong>Contextual Filtering</strong> - Geographic, seasonal, and soil-based elimination</li>
                <li><strong>Real-time Market Integration</strong> - Live price data from AGMARKNET API</li>
            </ul>
        </div>

        <h3>7.1 Algorithm Overview: How WMFS Recommends Crops</h3>

        <p>The <strong>Weighted Multi-Factor Scoring Algorithm (WMFS)</strong> recommends crops through a systematic 5-phase process:</p>

        <div class="flowchart">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           WMFS ALGORITHM: CROP RECOMMENDATION PROCESS                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   PHASE 1: DATA COLLECTION & PREPROCESSING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Farmer Profile â”‚    â”‚  Crop Dataset   â”‚    â”‚  Live Prices    â”‚
   â”‚  â€¢ State        â”‚    â”‚  â€¢ 50,000+ rows â”‚    â”‚  â€¢ AGMARKNET    â”‚
   â”‚  â€¢ Acreage      â”‚    â”‚  â€¢ 30+ crops    â”‚    â”‚  â€¢ MSP Fallback â”‚
   â”‚  â€¢ Soil Type    â”‚    â”‚  â€¢ All states   â”‚    â”‚  â€¢ 30min cache  â”‚
   â”‚  â€¢ Budget       â”‚    â”‚  â€¢ Yields/costs â”‚    â”‚                 â”‚
   â”‚  â€¢ Season       â”‚    â”‚                 â”‚    â”‚                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â”‚                      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
   PHASE 2: CONTEXTUAL FILTERING (Elimination)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Filter 1: Geographic Match (State)                            â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚  normalizeState(crop.state) === normalizeState(profile)   â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â”‚                           â”‚                                     â”‚
   â”‚                           â–¼                                     â”‚
   â”‚  Filter 2: Seasonal Match (Kharif/Rabi/Zaid/Whole Year)        â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚  season.includes(profile.season) || season="Whole Year"   â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â”‚                           â”‚                                     â”‚
   â”‚                           â–¼                                     â”‚
   â”‚  Fallback Strategy: If no matches, progressively relax filters â”‚
   â”‚  â€¢ Level 1: State only (ignore season)                         â”‚
   â”‚  â€¢ Level 2: Partial state match                                â”‚
   â”‚  â€¢ Level 3: Season only (any state)                            â”‚
   â”‚  â€¢ Level 4: Nationwide data                                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
   PHASE 3: ECONOMIC CALCULATION (Per Crop)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  For each filtered crop:                                        â”‚
   â”‚                                                                  â”‚
   â”‚  COSTS (per hectare):                                           â”‚
   â”‚  â”œâ”€â”€ Fertilizer Cost = max(avgFertilizer Ã— 0.05, â‚¹2000)        â”‚
   â”‚  â”œâ”€â”€ Pesticide Cost  = max(avgPesticide Ã— 0.1, â‚¹1000)          â”‚
   â”‚  â”œâ”€â”€ Labor Cost      = â‚¹15,000 (fixed)                         â”‚
   â”‚  â””â”€â”€ Seed Cost       = â‚¹5,000 (fixed)                          â”‚
   â”‚                                                                  â”‚
   â”‚  Total Cost = (Fertilizer + Pesticide + Labor + Seed) Ã— Acreageâ”‚
   â”‚                                                                  â”‚
   â”‚  REVENUE:                                                        â”‚
   â”‚  â”œâ”€â”€ Yield (quintals) = avgYield Ã— 10 (convert tonnes)         â”‚
   â”‚  â”œâ”€â”€ Market Price     = Live Price || MSP 2024-25              â”‚
   â”‚  â””â”€â”€ Revenue = Yield Ã— MarketPrice Ã— Acreage                   â”‚
   â”‚                                                                  â”‚
   â”‚  PROFIT = Revenue - Total Cost                                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
   PHASE 4: WEIGHTED SCORING (WMFS Core)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  SCORING FORMULA:                                                â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚                                                           â”‚  â”‚
   â”‚  â”‚  Final Score = (Budget Score Ã— 0.30)    â† 30% weight      â”‚  â”‚
   â”‚  â”‚              + (Profit Score Ã— 0.30)    â† 30% weight      â”‚  â”‚
   â”‚  â”‚              + (Yield Score  Ã— 0.20)    â† 20% weight      â”‚  â”‚
   â”‚  â”‚              + (ROI Score    Ã— 0.20)    â† 20% weight      â”‚  â”‚
   â”‚  â”‚                                                           â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â”‚                                                                  â”‚
   â”‚  COMPONENT CALCULATIONS:                                         â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
   â”‚  â”‚ Budget Score = cost â‰¤ budget ? 1 : max(0, budget/cost)    â”‚  â”‚
   â”‚  â”‚ Profit Score = profit > 0 ? min(profit/200000, 1) : 0     â”‚  â”‚
   â”‚  â”‚ Yield Score  = min(avgYield / 10, 1)                      â”‚  â”‚
   â”‚  â”‚ ROI Score    = cost > 0 ? min(profit/cost, 1) : 0         â”‚  â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
   PHASE 5: RANKING & SELECTION
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  1. Sort all crops by Final Score (descending)                  â”‚
   â”‚  2. Apply budget flexibility:                                   â”‚
   â”‚     â€¢ Primary: crops within 1.5Ã— budget                         â”‚
   â”‚     â€¢ Secondary: crops within 3Ã— budget                         â”‚
   â”‚     â€¢ Fallback: top profitable crops (any budget)               â”‚
   â”‚  3. If multiple crops requested:                                â”‚
   â”‚     â€¢ Apply companion crop logic for intercropping              â”‚
   â”‚     â€¢ Boost compatible crops (+10% score bonus)                 â”‚
   â”‚  4. Return top 8 recommendations                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>7.2 Mathematical Formulae</h3>

        <p>The WMFS algorithm uses the following mathematical formulae for crop recommendation:</p>

        <div class="success-box" style="background: #f3e5f5; border-left-color: #7b1fa2;">
            <h4 style="color: #7b1fa2; margin-top: 0;">ğŸ“ WMFS Core Formulae</h4>
            
            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">1. Final Score Calculation (Weighted Sum)</h5>
                <p style="font-size: 1.2em; text-align: center; padding: 15px; background: #f5f5f5; border-radius: 4px;">
                    <strong>S<sub>final</sub> = (S<sub>budget</sub> Ã— 0.30) + (S<sub>profit</sub> Ã— 0.30) + (S<sub>yield</sub> Ã— 0.20) + (S<sub>ROI</sub> Ã— 0.20)</strong>
                </p>
                <p style="font-size: 0.9em; color: #666;">Where S<sub>final</sub> âˆˆ [0, 1] represents the normalized recommendation score</p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">2. Individual Score Components</h5>
                
                <table style="width: 100%; margin: 10px 0; border-collapse: collapse;">
                    <tr style="background: #e3f2fd;">
                        <td style="padding: 12px; border: 1px solid #ddd; width: 25%;"><strong>Budget Score (S<sub>budget</sub>)</strong></td>
                        <td style="padding: 12px; border: 1px solid #ddd; font-family: monospace;">
                            S<sub>budget</sub> = 
                            <span style="display: inline-block; border-left: 2px solid #333; padding-left: 10px;">
                                1.0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if C<sub>total</sub> â‰¤ B<br>
                                max(0, B / C<sub>total</sub>) &nbsp;&nbsp; if C<sub>total</sub> > B
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd;"><strong>Profit Score (S<sub>profit</sub>)</strong></td>
                        <td style="padding: 12px; border: 1px solid #ddd; font-family: monospace;">
                            S<sub>profit</sub> = 
                            <span style="display: inline-block; border-left: 2px solid #333; padding-left: 10px;">
                                min(P / 200000, 1) &nbsp; if P > 0<br>
                                0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if P â‰¤ 0
                            </span>
                        </td>
                    </tr>
                    <tr style="background: #e3f2fd;">
                        <td style="padding: 12px; border: 1px solid #ddd;"><strong>Yield Score (S<sub>yield</sub>)</strong></td>
                        <td style="padding: 12px; border: 1px solid #ddd; font-family: monospace;">
                            S<sub>yield</sub> = min(Y<sub>avg</sub> / 10, 1)
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border: 1px solid #ddd;"><strong>ROI Score (S<sub>ROI</sub>)</strong></td>
                        <td style="padding: 12px; border: 1px solid #ddd; font-family: monospace;">
                            S<sub>ROI</sub> = 
                            <span style="display: inline-block; border-left: 2px solid #333; padding-left: 10px;">
                                min(P / C<sub>total</sub>, 1) &nbsp; if C<sub>total</sub> > 0<br>
                                0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if C<sub>total</sub> = 0
                            </span>
                        </td>
                    </tr>
                </table>
                
                <p style="font-size: 0.85em; color: #666; margin-top: 15px;">
                    <strong>Legend:</strong> B = Budget, P = Profit, Y<sub>avg</sub> = Average Yield (tonnes/hectare), C<sub>total</sub> = Total Cost
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">3. Cost Calculation Formulae</h5>
                
                <div style="background: #fff8e1; padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <p style="margin: 8px 0;"><strong>C<sub>fertilizer</sub></strong> = max(F<sub>avg</sub> Ã— 0.05, 2000) &nbsp;&nbsp;<em style="color: #666;">[â‚¹ per hectare]</em></p>
                    <p style="margin: 8px 0;"><strong>C<sub>pesticide</sub></strong> = max(P<sub>avg</sub> Ã— 0.10, 1000) &nbsp;&nbsp;<em style="color: #666;">[â‚¹ per hectare]</em></p>
                    <p style="margin: 8px 0;"><strong>C<sub>labor</sub></strong> = 15,000 &nbsp;&nbsp;<em style="color: #666;">[â‚¹ per hectare, fixed]</em></p>
                    <p style="margin: 8px 0;"><strong>C<sub>seed</sub></strong> = 5,000 &nbsp;&nbsp;<em style="color: #666;">[â‚¹ per hectare, fixed]</em></p>
                </div>
                
                <p style="font-size: 1.1em; text-align: center; padding: 10px; background: #e8f5e9; border-radius: 4px; margin: 15px 0;">
                    <strong>C<sub>hectare</sub> = C<sub>fertilizer</sub> + C<sub>pesticide</sub> + C<sub>labor</sub> + C<sub>seed</sub></strong>
                </p>
                
                <p style="font-size: 1.1em; text-align: center; padding: 10px; background: #ffebee; border-radius: 4px;">
                    <strong>C<sub>total</sub> = C<sub>hectare</sub> Ã— A</strong>
                    &nbsp;&nbsp;<em style="color: #666; font-size: 0.9em;">where A = Acreage (hectares)</em>
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">4. Revenue & Profit Formulae</h5>
                
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; margin: 10px 0;">
                    <p style="margin: 8px 0;"><strong>Y<sub>quintals</sub></strong> = Y<sub>avg</sub> Ã— 10 &nbsp;&nbsp;<em style="color: #666;">[Convert tonnes to quintals]</em></p>
                    <p style="margin: 8px 0;"><strong>R<sub>hectare</sub></strong> = Y<sub>quintals</sub> Ã— M<sub>price</sub> &nbsp;&nbsp;<em style="color: #666;">[â‚¹ per hectare]</em></p>
                    <p style="margin: 8px 0;"><strong>R<sub>total</sub></strong> = R<sub>hectare</sub> Ã— A &nbsp;&nbsp;<em style="color: #666;">[Total Revenue]</em></p>
                </div>
                
                <p style="font-size: 1.2em; text-align: center; padding: 15px; background: #c8e6c9; border-radius: 4px; margin: 15px 0;">
                    <strong style="color: #1b5e20;">P = R<sub>total</sub> - C<sub>total</sub></strong>
                    &nbsp;&nbsp;<em style="color: #2e7d32; font-size: 0.9em;">[Profit Formula]</em>
                </p>
                
                <p style="font-size: 0.85em; color: #666;">
                    <strong>Legend:</strong> M<sub>price</sub> = Market Price (â‚¹/quintal), R = Revenue, P = Profit, A = Acreage
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">5. Median Yield Calculation</h5>
                
                <p style="background: #f5f5f5; padding: 15px; border-radius: 4px;">
                    Given sorted yield array: Y = [y<sub>1</sub>, y<sub>2</sub>, ..., y<sub>n</sub>]<br><br>
                    <strong>Y<sub>avg</sub> = Y[âŒŠn/2âŒ‹]</strong> &nbsp;&nbsp;<em style="color: #666;">[Median for stability against outliers]</em>
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">6. Farming Type Suitability Scores</h5>
                
                <table style="width: 100%; margin: 10px 0; border-collapse: collapse; font-size: 0.95em;">
                    <tr style="background: #e8f5e9;">
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Organic</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd; font-family: monospace;">
                            S = 0.50 + 0.15Ã—I<sub>soil</sub> + 0.10Ã—I<sub>small</sub> + 0.10Ã—I<sub>budget</sub>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Intensive</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd; font-family: monospace;">
                            S = 0.40 + 0.20Ã—I<sub>highBudget</sub> + 0.15Ã—I<sub>large</sub> + 0.10Ã—I<sub>fertile</sub>
                        </td>
                    </tr>
                    <tr style="background: #e8f5e9;">
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Mixed</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd; font-family: monospace;">
                            S = 0.55 + 0.15Ã—I<sub>medium</sub> + 0.10Ã—I<sub>budget</sub>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Precision</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd; font-family: monospace;">
                            S = 0.30 + 0.25Ã—I<sub>veryHighBudget</sub> + 0.20Ã—I<sub>large</sub>
                        </td>
                    </tr>
                    <tr style="background: #e8f5e9;">
                        <td style="padding: 10px; border: 1px solid #ddd;"><strong>Sustainable</strong></td>
                        <td style="padding: 10px; border: 1px solid #ddd; font-family: monospace;">
                            S = 0.60 + 0.10Ã—I<sub>soil</sub> + 0.10Ã—I<sub>moderate</sub> + 0.10Ã—I<sub>budget</sub>
                        </td>
                    </tr>
                </table>
                
                <p style="font-size: 0.85em; color: #666; margin-top: 10px;">
                    <strong>Note:</strong> I<sub>x</sub> âˆˆ {0, 1} are indicator functions. Final score: S<sub>final</sub> = min(S, 1)
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #1565c0; border-bottom: 1px solid #ddd; padding-bottom: 5px;">7. Companion Crop Score Boost</h5>
                
                <p style="background: #e3f2fd; padding: 15px; border-radius: 4px; text-align: center;">
                    <strong>S<sub>boosted</sub> = min(S<sub>original</sub> Ã— 1.10, 1.0)</strong>
                    &nbsp;&nbsp;<em style="color: #666;">[10% bonus for compatible intercropping]</em>
                </p>
            </div>

            <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: 'Times New Roman', serif;">
                <h5 style="color: #d32f2f; border-bottom: 1px solid #ddd; padding-bottom: 5px;">8. Risk Assessment (Crops to Avoid)</h5>
                
                <p style="background: #ffebee; padding: 15px; border-radius: 4px;">
                    <strong>L<sub>estimated</sub> = Î£ (L<sub>factor</sub> Ã— A)</strong><br><br>
                    Where L<sub>factor</sub> values:<br>
                    â€¢ Unsuitable Soil: â‚¹15,000 Ã— A<br>
                    â€¢ Unsuitable Season: â‚¹20,000 Ã— A<br>
                    â€¢ Low Market Price: â‚¹10,000 Ã— A<br>
                    â€¢ Weather Risk: â‚¹8,000 Ã— A<br>
                    â€¢ Low Yield: â‚¹12,000 Ã— A<br>
                    â€¢ Negative Profit: max(L<sub>estimated</sub>, C<sub>total</sub> - R<sub>total</sub>)
                </p>
                
                <p style="margin-top: 15px;">
                    <strong>Risk Level:</strong><br>
                    â€¢ <span style="color: #d32f2f;">HIGH</span> = (count(risk_factors) â‰¥ 3) âˆ¨ (P < 0)<br>
                    â€¢ <span style="color: #f57c00;">MEDIUM</span> = count(risk_factors) = 2
                </p>
            </div>
        </div>

        <h3>7.3 Detailed Scoring Formula</h3>

        <p>The WMFS algorithm uses a weighted scoring system where each factor contributes to the final recommendation score:</p>

        <div class="info-box">
            <strong>WMFS Scoring Formula:</strong><br><br>
            <code style="font-size: 1.1em; background: #fff; padding: 10px; display: block; border-radius: 4px;">
                Final Score = (Budget Score Ã— 0.30) + (Profit Score Ã— 0.30) + (Yield Score Ã— 0.20) + (ROI Score Ã— 0.20)
            </code>
        </div>

        <table>
            <tr>
                <th>Score Component</th>
                <th>Weight</th>
                <th>Calculation</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td><strong>Budget Score</strong></td>
                <td>30%</td>
                <td><code>cost â‰¤ budget ? 1.0 : max(0, budget/cost)</code></td>
                <td>Ensures recommendations are affordable for the farmer</td>
            </tr>
            <tr>
                <td><strong>Profit Score</strong></td>
                <td>30%</td>
                <td><code>profit > 0 ? min(profit/200000, 1) : 0</code></td>
                <td>Prioritizes crops with higher absolute profit potential</td>
            </tr>
            <tr>
                <td><strong>Yield Score</strong></td>
                <td>20%</td>
                <td><code>min(avgYield / 10, 1)</code></td>
                <td>Favors high-yielding crops (normalized to 10 tonnes/hectare)</td>
            </tr>
            <tr>
                <td><strong>ROI Score</strong></td>
                <td>20%</td>
                <td><code>cost > 0 ? min(profit/cost, 1) : 0</code></td>
                <td>Return on Investment - efficiency of capital use</td>
            </tr>
        </table>

        <h3>7.4 Economic Calculations</h3>

        <div class="info-box">
            <strong>Cost & Revenue Formulas:</strong>
            <ul style="margin-top: 10px;">
                <li><strong>Fertilizer Cost</strong> = max(avgFertilizer Ã— 0.05, â‚¹2000) per hectare</li>
                <li><strong>Pesticide Cost</strong> = max(avgPesticide Ã— 0.1, â‚¹1000) per hectare</li>
                <li><strong>Labor Cost</strong> = â‚¹15,000 per hectare (fixed)</li>
                <li><strong>Seed Cost</strong> = â‚¹5,000 per hectare (fixed)</li>
                <li><strong>Total Cost</strong> = (Fertilizer + Pesticide + Labor + Seed) Ã— Acreage</li>
                <li><strong>Yield</strong> = Average Yield (tonnes/hectare) Ã— 10 = Quintals</li>
                <li><strong>Revenue</strong> = Yield (quintals) Ã— Market Price Ã— Acreage</li>
                <li><strong>Profit</strong> = Revenue - Total Cost</li>
            </ul>
        </div>

        <h3>7.5 Farming Type Scoring Algorithms</h3>

        <p>The system uses separate scoring algorithms to recommend the most suitable farming type based on the farmer's profile:</p>

        <div class="info-box">
            <strong>Farming Type Scoring Formulas:</strong>
            <table style="margin-top: 15px; background: white;">
                <tr>
                    <th>Farming Type</th>
                    <th>Scoring Algorithm</th>
                    <th>Suitability Factors</th>
                </tr>
                <tr>
                    <td><strong>Organic Farming</strong></td>
                    <td>
                        <code>Base: 0.50</code><br>
                        <code>+0.15 if Loamy/Clay soil</code><br>
                        <code>+0.10 if acreage â‰¤ 10</code><br>
                        <code>+0.10 if budget â‰¥ â‚¹30,000</code>
                    </td>
                    <td>Small farms, good soil, premium markets</td>
                </tr>
                <tr>
                    <td><strong>Intensive Farming</strong></td>
                    <td>
                        <code>Base: 0.40</code><br>
                        <code>+0.20 if budget â‰¥ â‚¹1,00,000</code><br>
                        <code>+0.15 if acreage â‰¥ 5</code><br>
                        <code>+0.10 if Loamy/Alluvial soil</code>
                    </td>
                    <td>High budget, larger farms, fertile soil</td>
                </tr>
                <tr>
                    <td><strong>Mixed Farming</strong></td>
                    <td>
                        <code>Base: 0.55</code><br>
                        <code>+0.15 if 3 â‰¤ acreage â‰¤ 15</code><br>
                        <code>+0.10 if budget â‰¥ â‚¹50,000</code>
                    </td>
                    <td>Medium-sized farms, diversification</td>
                </tr>
                <tr>
                    <td><strong>Precision Farming</strong></td>
                    <td>
                        <code>Base: 0.30</code><br>
                        <code>+0.25 if budget â‰¥ â‚¹2,00,000</code><br>
                        <code>+0.20 if acreage â‰¥ 10</code>
                    </td>
                    <td>High investment capacity, large farms</td>
                </tr>
                <tr>
                    <td><strong>Sustainable Farming</strong></td>
                    <td>
                        <code>Base: 0.60</code><br>
                        <code>+0.10 if Loamy/Sandy Loam soil</code><br>
                        <code>+0.10 if acreage â‰¤ 20</code><br>
                        <code>+0.10 if budget â‰¥ â‚¹40,000</code>
                    </td>
                    <td>Long-term planning, moderate resources</td>
                </tr>
            </table>
        </div>

        <h3>7.6 Intercropping & Multiple Crops Algorithm</h3>

        <p>When a farmer requests multiple crop recommendations, the algorithm uses a <strong>Companion Crop Selection Algorithm</strong>:</p>

        <div class="flowchart">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           COMPANION CROP SELECTION ALGORITHM                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Step 1: Select Top Crop
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Add highest-scoring crop to selection                    â”‚
   â”‚  Example: Rice (score: 0.85)                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
   Step 2: Find Companion Crops
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Check compatibility matrix:                              â”‚
   â”‚  â€¢ Rice â†’ Pulses, Gram, Moong, Urad                       â”‚
   â”‚  â€¢ Wheat â†’ Gram, Mustard, Linseed                         â”‚
   â”‚  â€¢ Maize â†’ Beans, Groundnut, Soyabean, Cowpea            â”‚
   â”‚  â€¢ Cotton â†’ Groundnut, Moong, Gram                        â”‚
   â”‚  â€¢ Sugarcane â†’ Potato, Onion, Garlic, Turmeric           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
   Step 3: Score Boosting
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Companion crops receive +10% score bonus                 â”‚
   â”‚  crop.score = min(crop.score Ã— 1.1, 1.0)                  â”‚
   â”‚  Mark as "Intercropping Compatible"                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
   Step 4: Diversification
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Select up to 6-8 diverse crops for risk distribution    â”‚
   â”‚  Ensure mix of cereals, pulses, oilseeds where possible  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>7.7 Crops to Avoid Algorithm (Risk Assessment)</h3>

        <p>The system identifies crops that farmers should avoid using a multi-factor <strong>Risk Assessment Algorithm</strong>:</p>

        <div class="warning-box">
            <strong>Risk Factors Evaluated:</strong>
            <table style="margin-top: 15px; background: white;">
                <tr>
                    <th>Risk Factor</th>
                    <th>Condition</th>
                    <th>Estimated Loss Added</th>
                </tr>
                <tr>
                    <td><strong>Unsuitable Soil</strong></td>
                    <td>Crop incompatible with farmer's soil type</td>
                    <td>â‚¹15,000 Ã— acreage</td>
                </tr>
                <tr>
                    <td><strong>Unsuitable Season</strong></td>
                    <td>Crop grown in wrong season</td>
                    <td>â‚¹20,000 Ã— acreage</td>
                </tr>
                <tr>
                    <td><strong>Low Market Price</strong></td>
                    <td>Volatile crops (Potato, Onion, Tomato)</td>
                    <td>â‚¹10,000 Ã— acreage</td>
                </tr>
                <tr>
                    <td><strong>High Input Cost</strong></td>
                    <td>Cost exceeds 80% of budget</td>
                    <td>Cost - Budget</td>
                </tr>
                <tr>
                    <td><strong>Weather Risk</strong></td>
                    <td>Climate-sensitive crops</td>
                    <td>â‚¹8,000 Ã— acreage</td>
                </tr>
                <tr>
                    <td><strong>Low Yield</strong></td>
                    <td>Yield < 1.5 tonnes/hectare</td>
                    <td>â‚¹12,000 Ã— acreage</td>
                </tr>
                <tr>
                    <td><strong>Negative Profit Margin</strong></td>
                    <td>Revenue < Cost</td>
                    <td>Cost - Revenue</td>
                </tr>
            </table>
            <p style="margin-top: 15px;"><strong>Risk Level Assignment:</strong></p>
            <ul>
                <li><span style="color: #d32f2f;"><strong>HIGH RISK:</strong></span> 3+ risk factors OR negative profit margin</li>
                <li><span style="color: #f57c00;"><strong>MEDIUM RISK:</strong></span> 2 risk factors</li>
            </ul>
        </div>

        <h3>7.8 Live Market Price Integration</h3>

        <p>The algorithm integrates real-time market prices from government APIs:</p>

        <div class="info-box">
            <strong>Price Data Sources (Priority Order):</strong>
            <ol>
                <li><strong>AGMARKNET API</strong> - data.gov.in Agricultural Market Information System (Primary)</li>
                <li><strong>MSP 2024-25</strong> - Minimum Support Prices as fallback (Secondary)</li>
            </ol>
            <p style="margin-top: 10px;"><strong>Caching Strategy:</strong> Prices cached for 30 minutes to reduce API calls</p>
            <p><strong>Price Variation:</strong> Fallback prices include Â±10% random variation for realism</p>
        </div>

        <!-- Section 8: Key Code Snippets -->
        <h2 id="code-snippets" class="page-break">8. Key Code Snippets</h2>
        
        <h3>8.1 Express Server Entry Point</h3>

        <pre><code><span class="comment">// server/src/index.ts - Main Server Entry</span>
<span class="keyword">import</span> express, { Express, Request, Response } <span class="keyword">from</span> <span class="string">'express'</span>;
<span class="keyword">import</span> cors <span class="keyword">from</span> <span class="string">'cors'</span>;
<span class="keyword">import</span> dotenv <span class="keyword">from</span> <span class="string">'dotenv'</span>;
<span class="keyword">import</span> { router <span class="keyword">as</span> cropRoutes } <span class="keyword">from</span> <span class="string">'./routes/cropRoutes'</span>;
<span class="keyword">import</span> { router <span class="keyword">as</span> weatherRoutes } <span class="keyword">from</span> <span class="string">'./routes/weatherRoutes'</span>;
<span class="keyword">import</span> { router <span class="keyword">as</span> marketRoutes } <span class="keyword">from</span> <span class="string">'./routes/marketRoutes'</span>;
<span class="keyword">import</span> { router <span class="keyword">as</span> authRoutes } <span class="keyword">from</span> <span class="string">'./routes/authRoutes'</span>;
<span class="keyword">import</span> { router <span class="keyword">as</span> userRoutes } <span class="keyword">from</span> <span class="string">'./routes/userRoutes'</span>;
<span class="keyword">import</span> { errorHandler } <span class="keyword">from</span> <span class="string">'./middleware/errorHandler'</span>;
<span class="keyword">import</span> { setupDatabase } <span class="keyword">from</span> <span class="string">'./config/database'</span>;

dotenv.<span class="function">config</span>();

<span class="keyword">const</span> app: Express = <span class="function">express</span>();
<span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3001</span>;

<span class="comment">// Middleware</span>
app.<span class="function">use</span>(<span class="function">cors</span>());
app.<span class="function">use</span>(express.<span class="function">json</span>());
app.<span class="function">use</span>(express.<span class="function">urlencoded</span>({ extended: <span class="keyword">true</span> }));

<span class="comment">// Health check endpoint</span>
app.<span class="function">get</span>(<span class="string">'/health'</span>, (req: Request, res: Response) => {
  res.<span class="function">json</span>({ status: <span class="string">'ok'</span>, timestamp: <span class="keyword">new</span> Date().<span class="function">toISOString</span>() });
});

<span class="comment">// API Routes</span>
app.<span class="function">use</span>(<span class="string">'/api/crops'</span>, cropRoutes);
app.<span class="function">use</span>(<span class="string">'/api/weather'</span>, weatherRoutes);
app.<span class="function">use</span>(<span class="string">'/api/market'</span>, marketRoutes);
app.<span class="function">use</span>(<span class="string">'/api/auth'</span>, authRoutes);
app.<span class="function">use</span>(<span class="string">'/api/users'</span>, userRoutes);

<span class="comment">// Error handling middleware</span>
app.<span class="function">use</span>(errorHandler);

<span class="comment">// Initialize database and start server</span>
<span class="keyword">async function</span> <span class="function">startServer</span>() {
  <span class="keyword">try</span> {
    <span class="keyword">await</span> <span class="function">setupDatabase</span>();
    app.<span class="function">listen</span>(PORT, () => {
      console.<span class="function">log</span>(<span class="string">`âœ… Server running on http://localhost:${PORT}`</span>);
      console.<span class="function">log</span>(<span class="string">`ğŸ“Š Database initialized`</span>);
    });
  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">'Failed to start server:'</span>, error);
    process.<span class="function">exit</span>(<span class="number">1</span>);
  }
}

<span class="function">startServer</span>();</code></pre>

        <h3>8.2 JWT Authentication Middleware</h3>

        <pre><code><span class="comment">// server/src/middleware/auth.ts - JWT Authentication</span>
<span class="keyword">import</span> { Request, Response, NextFunction } <span class="keyword">from</span> <span class="string">'express'</span>;
<span class="keyword">import</span> jwt <span class="keyword">from</span> <span class="string">'jsonwebtoken'</span>;
<span class="keyword">import</span> { AppError } <span class="keyword">from</span> <span class="string">'./errorHandler'</span>;

<span class="keyword">const</span> JWT_SECRET = process.env.JWT_SECRET || <span class="string">'your-secret-key'</span>;

<span class="keyword">export interface</span> <span class="type">AuthRequest</span> <span class="keyword">extends</span> Request {
  userId?: <span class="type">number</span>;
}

<span class="keyword">export function</span> <span class="function">authenticateToken</span>(
  req: <span class="type">AuthRequest</span>,
  res: Response,
  next: NextFunction
): <span class="type">void</span> {
  <span class="comment">// Extract token from Authorization header</span>
  <span class="keyword">const</span> authHeader = req.headers[<span class="string">'authorization'</span>];
  <span class="keyword">const</span> token = authHeader && authHeader.<span class="function">split</span>(<span class="string">' '</span>)[<span class="number">1</span>];

  <span class="keyword">if</span> (!token) {
    <span class="keyword">throw new</span> <span class="function">AppError</span>(<span class="string">'Access token required'</span>, <span class="number">401</span>);
  }

  <span class="keyword">try</span> {
    <span class="comment">// Verify the token</span>
    <span class="keyword">const</span> decoded = jwt.<span class="function">verify</span>(token, JWT_SECRET) <span class="keyword">as</span> { userId: <span class="type">number</span> };
    req.userId = decoded.userId;
    <span class="function">next</span>();
  } <span class="keyword">catch</span> (error) {
    <span class="keyword">throw new</span> <span class="function">AppError</span>(<span class="string">'Invalid or expired token'</span>, <span class="number">403</span>);
  }
}

<span class="keyword">export function</span> <span class="function">generateToken</span>(userId: <span class="type">number</span>): <span class="type">string</span> {
  <span class="keyword">return</span> jwt.<span class="function">sign</span>({ userId }, JWT_SECRET, { expiresIn: <span class="string">'7d'</span> });
}</code></pre>

        <h3>8.3 Crop Recommendation Engine</h3>

        <pre><code><span class="comment">// server/src/routes/cropRoutes.ts - Recommendation Logic</span>
router.<span class="function">post</span>(<span class="string">'/recommend'</span>, authenticateToken, <span class="keyword">async</span> (req: AuthRequest, res: Response) => {
  <span class="keyword">const</span> { state, acreage, soilType, season, rainfall, temperature } = req.body;

  <span class="keyword">if</span> (!state || !acreage || !soilType) {
    <span class="keyword">throw new</span> <span class="function">AppError</span>(<span class="string">'State, acreage, and soilType are required'</span>, <span class="number">400</span>);
  }

  <span class="comment">// Load crop dataset</span>
  <span class="keyword">const</span> csvPath = path.<span class="function">join</span>(process.<span class="function">cwd</span>(), <span class="string">'public'</span>, <span class="string">'data'</span>, <span class="string">'crop_dataset.csv'</span>);
  <span class="keyword">const</span> csvContent = <span class="keyword">await</span> fs.<span class="function">readFile</span>(csvPath, <span class="string">'utf-8'</span>);
  <span class="keyword">const</span> records = <span class="function">parse</span>(csvContent, { columns: <span class="keyword">true</span>, skip_empty_lines: <span class="keyword">true</span> });

  <span class="comment">// Filter and score crops</span>
  <span class="keyword">const</span> recommendations = records
    .<span class="function">filter</span>((crop: <span class="type">any</span>) => {
      <span class="comment">// Level 1 & 2: State and Season filtering</span>
      <span class="keyword">if</span> (season && crop.season && 
          crop.season.<span class="function">toLowerCase</span>() !== season.<span class="function">toLowerCase</span>()) {
        <span class="keyword">return false</span>;
      }
      <span class="keyword">if</span> (state && crop.state && 
          crop.state.<span class="function">toLowerCase</span>() !== state.<span class="function">toLowerCase</span>()) {
        <span class="keyword">return false</span>;
      }
      <span class="keyword">return true</span>;
    })
    .<span class="function">map</span>((crop: <span class="type">any</span>) => {
      <span class="comment">// Base score</span>
      <span class="keyword">let</span> score = <span class="number">50</span>;
      
      <span class="comment">// Rainfall match scoring (0-25 points)</span>
      <span class="keyword">if</span> (rainfall && crop.rainfall) {
        <span class="keyword">const</span> rainfallDiff = Math.<span class="function">abs</span>(
          <span class="function">parseFloat</span>(crop.rainfall) - <span class="function">parseFloat</span>(rainfall)
        );
        score += Math.<span class="function">max</span>(<span class="number">0</span>, <span class="number">25</span> - rainfallDiff / <span class="number">10</span>);
      }

      <span class="comment">// Soil type match (15 points)</span>
      <span class="keyword">if</span> (soilType && crop.soilType && 
          crop.soilType.<span class="function">toLowerCase</span>().<span class="function">includes</span>(soilType.<span class="function">toLowerCase</span>())) {
        score += <span class="number">15</span>;
      }

      <span class="comment">// Economic calculations</span>
      <span class="keyword">const</span> yieldPerHectare = <span class="function">parseFloat</span>(crop.yieldPerHectare || <span class="number">0</span>);
      <span class="keyword">const</span> hectares = acreage * <span class="number">0.404686</span>; <span class="comment">// Acres to hectares</span>
      <span class="keyword">const</span> estimatedYield = yieldPerHectare * hectares;
      <span class="keyword">const</span> pricePerUnit = <span class="function">parseFloat</span>(crop.price || <span class="number">0</span>);
      <span class="keyword">const</span> estimatedRevenue = estimatedYield * pricePerUnit;

      <span class="keyword">return</span> {
        name: crop.crop || crop.name,
        yield: estimatedYield,
        estimatedRevenue,
        score: Math.<span class="function">min</span>(<span class="number">100</span>, score),
        season: crop.season,
        soilType: crop.soilType,
        yieldPerHectare
      };
    })
    .<span class="function">sort</span>((a: <span class="type">any</span>, b: <span class="type">any</span>) => b.score - a.score)
    .<span class="function">slice</span>(<span class="number">0</span>, <span class="number">10</span>);

  <span class="comment">// Save top 3 recommendations to database</span>
  <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="function">getDatabase</span>();
  <span class="keyword">for</span> (<span class="keyword">const</span> rec <span class="keyword">of</span> recommendations.<span class="function">slice</span>(<span class="number">0</span>, <span class="number">3</span>)) {
    <span class="keyword">await</span> db.<span class="function">run</span>(
      <span class="string">`INSERT INTO recommendations 
       (user_id, crop_name, score, estimated_yield, estimated_revenue, season, parameters) 
       VALUES (?, ?, ?, ?, ?, ?, ?)`</span>,
      req.userId, rec.name, rec.score, rec.yield, 
      rec.estimatedRevenue, rec.season, 
      JSON.<span class="function">stringify</span>({ state, soilType, acreage })
    );
  }

  res.<span class="function">json</span>({ recommendations, count: recommendations.length });
});</code></pre>

        <h3>8.4 Frontend API Service</h3>

        <pre><code><span class="comment">// src/services/api.ts - Frontend API Integration</span>
<span class="keyword">const</span> API_BASE = <span class="keyword">import</span>.meta.env.VITE_API_BASE || <span class="string">"http://localhost:3001/api"</span>;

<span class="comment">// Helper to get auth token from storage</span>
<span class="keyword">function</span> <span class="function">getAuthToken</span>(): <span class="type">string</span> | <span class="type">null</span> {
  <span class="keyword">return</span> localStorage.<span class="function">getItem</span>(<span class="string">'authToken'</span>);
}

<span class="comment">// Helper to make authenticated requests</span>
<span class="keyword">async function</span> <span class="function">fetchWithAuth</span>(url: <span class="type">string</span>, options: RequestInit = {}) {
  <span class="keyword">const</span> token = <span class="function">getAuthToken</span>();
  <span class="keyword">const</span> headers: HeadersInit = {
    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,
    ...options.headers,
  };
  
  <span class="keyword">if</span> (token) {
    headers[<span class="string">'Authorization'</span>] = <span class="string">`Bearer ${token}`</span>;
  }

  <span class="keyword">return</span> <span class="function">fetch</span>(url, { ...options, headers });
}

<span class="comment">// Login API call</span>
<span class="keyword">export async function</span> <span class="function">login</span>(email: <span class="type">string</span>, password: <span class="type">string</span>) {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">`${API_BASE}/auth/login`</span>, {
      method: <span class="string">'POST'</span>,
      headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
      body: JSON.<span class="function">stringify</span>({ email, password })
    });
    
    <span class="keyword">if</span> (!response.ok) {
      <span class="keyword">const</span> error = <span class="keyword">await</span> response.<span class="function">json</span>();
      <span class="keyword">throw new</span> <span class="function">Error</span>(error.message || <span class="string">'Login failed'</span>);
    }
    
    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();
    <span class="keyword">if</span> (data.token) {
      localStorage.<span class="function">setItem</span>(<span class="string">'authToken'</span>, data.token);
    }
    <span class="keyword">return</span> data;
  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">"Login error:"</span>, error);
    <span class="keyword">throw</span> error;
  }
}

<span class="comment">// Fetch crop recommendations</span>
<span class="keyword">export async function</span> <span class="function">fetchCropRecommendations</span>(params: {
  state: <span class="type">string</span>;
  acreage: <span class="type">number</span>;
  soilType: <span class="type">string</span>;
  season?: <span class="type">string</span>;
  rainfall?: <span class="type">number</span>;
}) {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetchWithAuth</span>(<span class="string">`${API_BASE}/crops/recommend`</span>, {
      method: <span class="string">'POST'</span>,
      body: JSON.<span class="function">stringify</span>(params)
    });
    
    <span class="keyword">if</span> (!response.ok) <span class="keyword">throw new</span> <span class="function">Error</span>(<span class="string">"Recommendation failed"</span>);
    <span class="keyword">return await</span> response.<span class="function">json</span>();
  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">"Recommendation error:"</span>, error);
    <span class="keyword">return null</span>;
  }
}</code></pre>

        <h3>8.5 Live Market Price Fetching</h3>

        <pre><code><span class="comment">// src/services/recommender.ts - Live Price Fetching from Government API</span>
<span class="keyword">let</span> livePriceCache: Record&lt;<span class="type">string</span>, { price: <span class="type">number</span>; timestamp: <span class="type">number</span>; source: <span class="type">string</span> }&gt; = {};
<span class="keyword">const</span> CACHE_DURATION = <span class="number">30</span> * <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 30 minutes</span>

<span class="keyword">export async function</span> <span class="function">fetchLiveMarketPrices</span>(
  commodities: <span class="type">string</span>[]
): Promise&lt;Record&lt;<span class="type">string</span>, { price: <span class="type">number</span>; source: <span class="type">string</span> }&gt;&gt; {
  <span class="keyword">const</span> prices: Record&lt;<span class="type">string</span>, { price: <span class="type">number</span>; source: <span class="type">string</span> }&gt; = {};
  <span class="keyword">const</span> now = Date.<span class="function">now</span>();
  
  <span class="comment">// Check cache first</span>
  <span class="keyword">const</span> commoditiesToFetch = commodities.<span class="function">filter</span>(c => {
    <span class="keyword">const</span> cached = livePriceCache[c];
    <span class="keyword">return</span> !cached || (now - cached.timestamp) > CACHE_DURATION;
  });
  
  <span class="comment">// Return cached prices for items we don't need to fetch</span>
  commodities.<span class="function">forEach</span>(c => {
    <span class="keyword">const</span> cached = livePriceCache[c];
    <span class="keyword">if</span> (cached && (now - cached.timestamp) <= CACHE_DURATION) {
      prices[c] = { price: cached.price, source: cached.source };
    }
  });
  
  <span class="keyword">if</span> (commoditiesToFetch.length === <span class="number">0</span>) {
    <span class="keyword">return</span> prices;
  }
  
  <span class="keyword">try</span> {
    <span class="comment">// Fetch from data.gov.in API (AGMARKNET)</span>
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(
      <span class="string">`https://api.data.gov.in/resource/9ef84268-d588-465a-a308-a864a43d0070
       ?api-key=YOUR_API_KEY&format=json&limit=100`</span>,
      { signal: AbortSignal.<span class="function">timeout</span>(<span class="number">5000</span>) }
    );
    
    <span class="keyword">if</span> (response.ok) {
      <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="function">json</span>();
      <span class="keyword">if</span> (data.records) {
        data.records.<span class="function">forEach</span>((record: <span class="type">any</span>) => {
          <span class="keyword">const</span> commodity = record.commodity?.<span class="function">trim</span>();
          <span class="keyword">const</span> modalPrice = <span class="function">parseFloat</span>(record.modal_price) || <span class="number">0</span>;
          <span class="keyword">if</span> (commodity && modalPrice > <span class="number">0</span>) {
            <span class="keyword">const</span> mappedName = <span class="function">mapCommodityName</span>(commodity);
            <span class="keyword">if</span> (mappedName && commoditiesToFetch.<span class="function">includes</span>(mappedName)) {
              livePriceCache[mappedName] = { 
                price: modalPrice, 
                timestamp: now, 
                source: <span class="string">"AGMARKNET"</span> 
              };
              prices[mappedName] = { price: modalPrice, source: <span class="string">"AGMARKNET"</span> };
            }
          }
        });
      }
    }
  } <span class="keyword">catch</span> (error) {
    console.<span class="function">log</span>(<span class="string">"Live price fetch failed, using fallback prices"</span>);
  }
  
  <span class="comment">// Use fallback MSP prices for commodities without live data</span>
  commoditiesToFetch.<span class="function">forEach</span>(c => {
    <span class="keyword">if</span> (!prices[c]) {
      <span class="keyword">const</span> fallbackPrice = MARKET_PRICES[c] || MARKET_PRICES[<span class="string">"Default"</span>];
      <span class="keyword">const</span> variation = <span class="number">1</span> + (Math.<span class="function">random</span>() * <span class="number">0.2</span> - <span class="number">0.1</span>);
      prices[c] = { 
        price: Math.<span class="function">round</span>(fallbackPrice * variation), 
        source: <span class="string">"MSP 2024-25"</span> 
      };
    }
  });
  
  <span class="keyword">return</span> prices;
}</code></pre>

        <!-- Section 9: Security Architecture -->
        <h2 id="security" class="page-break">9. Security Architecture</h2>
        
        <div class="architecture">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SECURITY LAYERS                               â”‚
â”‚                                                                 â”‚
â”‚  LAYER 1: FRONTEND SECURITY                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚  â€¢ Token stored in localStorage                                â”‚
â”‚  â€¢ Auto-logout on token expiration                             â”‚
â”‚  â€¢ Redirect to login for protected routes                      â”‚
â”‚  â€¢ Input validation before API calls                           â”‚
â”‚                                                                 â”‚
â”‚  LAYER 2: NETWORK SECURITY                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚  â€¢ CORS configured (only frontend origin allowed)              â”‚
â”‚  â€¢ HTTPS in production (enforced by hosting)                   â”‚
â”‚  â€¢ Request timeout limits                                       â”‚
â”‚                                                                 â”‚
â”‚  LAYER 3: API MIDDLEWARE                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ JWT verification on protected routes                        â”‚
â”‚  â€¢ Token expiration check (7 days)                             â”‚
â”‚  â€¢ Error handling (no sensitive data leaks)                    â”‚
â”‚  â€¢ Request body validation                                      â”‚
â”‚                                                                 â”‚
â”‚  LAYER 4: DATABASE SECURITY                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚  â€¢ Parameterized queries (SQL injection protection)            â”‚
â”‚  â€¢ Bcrypt password hashing (salt rounds: 10)                   â”‚
â”‚  â€¢ Foreign key constraints                                      â”‚
â”‚  â€¢ User data isolation (userId in queries)                     â”‚
â”‚                                                                 â”‚
â”‚  LAYER 5: ENVIRONMENT SECURITY                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚  â€¢ Secrets in .env (not committed to Git)                      â”‚
â”‚  â€¢ JWT_SECRET required for production                          â”‚
â”‚  â€¢ API keys protected                                           â”‚
â”‚  â€¢ Environment-specific configurations                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>9.1 Authentication Flow Security</h3>

        <table>
            <tr>
                <th>Security Measure</th>
                <th>Implementation</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td>Password Hashing</td>
                <td>bcrypt with 10 salt rounds</td>
                <td>Secure password storage</td>
            </tr>
            <tr>
                <td>JWT Tokens</td>
                <td>HS256 algorithm, 7-day expiry</td>
                <td>Stateless authentication</td>
            </tr>
            <tr>
                <td>Token Storage</td>
                <td>localStorage (client-side)</td>
                <td>Persistent sessions</td>
            </tr>
            <tr>
                <td>CORS Policy</td>
                <td>Whitelist frontend origin only</td>
                <td>Prevent cross-origin attacks</td>
            </tr>
            <tr>
                <td>Error Handling</td>
                <td>Generic error messages</td>
                <td>No information leakage</td>
            </tr>
        </table>

        <!-- Section 10: Deployment Guide -->
        <h2 id="deployment" class="page-break">10. Deployment Guide</h2>
        
        <h3>10.1 Production Architecture</h3>

        <div class="architecture">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PRODUCTION DEPLOYMENT                          â”‚
â”‚                                                                 â”‚
â”‚  User Browser                                                   â”‚
â”‚       â†“                                                         â”‚
â”‚  Vercel CDN (Frontend)                                          â”‚
â”‚    â€¢ Static files cached globally                               â”‚
â”‚    â€¢ Edge network distribution                                  â”‚
â”‚    â€¢ Automatic HTTPS                                            â”‚
â”‚    â€¢ Build: npm run build                                       â”‚
â”‚       â†“                                                         â”‚
â”‚  Railway/Render (Backend API)                                   â”‚
â”‚    â€¢ Node.js Express server                                     â”‚
â”‚    â€¢ Environment variables configured                           â”‚
â”‚    â€¢ Automatic scaling                                          â”‚
â”‚    â€¢ Build: npm run build:server                               â”‚
â”‚       â†“                                                         â”‚
â”‚  SQLite / PostgreSQL Database                                   â”‚
â”‚    â€¢ SQLite: Good for < 10,000 users                           â”‚
â”‚    â€¢ PostgreSQL: Recommended for scale                          â”‚
â”‚    â€¢ Automatic backups (with PostgreSQL)                        â”‚
â”‚                                                                 â”‚
â”‚  External Services:                                             â”‚
â”‚    â€¢ OpenWeather API (weather data)                             â”‚
â”‚    â€¢ data.gov.in API (market prices)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </div>

        <h3>10.2 Environment Variables</h3>

        <h4>Frontend (.env)</h4>
        <pre><code>VITE_API_BASE=https://your-backend-url.com/api</code></pre>

        <h4>Backend (server/.env)</h4>
        <pre><code>NODE_ENV=production
PORT=3001
JWT_SECRET=generate-a-secure-random-string-at-least-32-chars
OPENWEATHER_API_KEY=your-openweather-api-key
FRONTEND_URL=https://your-frontend-url.com
DATABASE_PATH=./data/crop_recommender.db</code></pre>

        <h3>10.3 Deployment Steps</h3>

        <h4>Deploy Frontend to Vercel</h4>
        <pre><code><span class="comment"># Install Vercel CLI</span>
npm install -g vercel

<span class="comment"># Build the frontend</span>
npm run build

<span class="comment"># Deploy to Vercel</span>
vercel --prod</code></pre>

        <h4>Deploy Backend to Railway</h4>
        <ol>
            <li>Go to <a href="https://railway.app">railway.app</a> and sign in</li>
            <li>Click "New Project" â†’ "Deploy from GitHub repo"</li>
            <li>Configure:
                <ul>
                    <li>Root Directory: <code>server</code></li>
                    <li>Build Command: <code>npm install && npm run build</code></li>
                    <li>Start Command: <code>npm start</code></li>
                </ul>
            </li>
            <li>Add environment variables</li>
            <li>Deploy and get your backend URL</li>
        </ol>

        <!-- Section 11: Testing Guide -->
        <h2 id="testing" class="page-break">11. Testing Guide</h2>
        
        <h3>11.1 API Testing with cURL</h3>

        <h4>Health Check</h4>
        <pre><code>curl http://localhost:3001/health</code></pre>

        <h4>Register User</h4>
        <pre><code>curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"farmer@test.com","password":"test123","name":"Test Farmer"}'</code></pre>

        <h4>Login</h4>
        <pre><code>curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"farmer@test.com","password":"test123"}'</code></pre>

        <h4>Get Weather</h4>
        <pre><code>curl "http://localhost:3001/api/weather/current?location=Mumbai"</code></pre>

        <h4>Get Market Prices</h4>
        <pre><code>curl "http://localhost:3001/api/market/prices/rice?state=Maharashtra"</code></pre>

        <h4>Get Recommendations (with auth)</h4>
        <pre><code>curl -X POST http://localhost:3001/api/crops/recommend \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"state":"Maharashtra","acreage":10,"soilType":"loamy","season":"kharif"}'</code></pre>

        <h3>11.2 Expected API Responses</h3>

        <h4>Login Response</h4>
        <pre><code>{
  "message": "Login successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "email": "farmer@test.com",
    "name": "Test Farmer"
  }
}</code></pre>

        <h4>Weather Response</h4>
        <pre><code>{
  "location": "Mumbai",
  "temperature": 28.5,
  "humidity": 65,
  "rainfall": 0,
  "condition": "Partly Cloudy",
  "source": "openweathermap"
}</code></pre>

        <h4>Recommendations Response</h4>
        <pre><code>{
  "recommendations": [
    {
      "name": "Rice",
      "yield": 2250.5,
      "estimatedRevenue": 45000,
      "score": 85,
      "season": "kharif",
      "soilType": "loamy",
      "yieldPerHectare": 2500
    }
  ],
  "count": 10
}</code></pre>

        <!-- Section 12: Features Summary -->
        <h2 id="features" class="page-break">12. Features Summary</h2>
        
        <div class="success-box">
            <h4>âœ… Complete System Features</h4>
            <ul>
                <li><strong>25 API Endpoints</strong> - Full REST API coverage</li>
                <li><strong>5 Database Tables</strong> - Complete data model</li>
                <li><strong>JWT Authentication</strong> - Secure user sessions</li>
                <li><strong>Weather Integration</strong> - Real-time and forecast data</li>
                <li><strong>Market Price Tracking</strong> - Government API integration</li>
                <li><strong>Crop Recommendations</strong> - Multi-factor scoring algorithm</li>
                <li><strong>User Profiles & History</strong> - Complete farmer management</li>
                <li><strong>Data Visualization</strong> - Interactive charts and graphs</li>
            </ul>
        </div>

        <h3>12.1 Available NPM Scripts</h3>

        <table>
            <tr>
                <th>Command</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>npm run dev</code></td>
                <td>Start frontend only</td>
            </tr>
            <tr>
                <td><code>npm run dev:server</code></td>
                <td>Start backend only</td>
            </tr>
            <tr>
                <td><code>npm run dev:all</code></td>
                <td>Start both frontend and backend</td>
            </tr>
            <tr>
                <td><code>npm run build</code></td>
                <td>Build frontend for production</td>
            </tr>
            <tr>
                <td><code>npm run build:server</code></td>
                <td>Build backend for production</td>
            </tr>
            <tr>
                <td><code>npm run server:install</code></td>
                <td>Install backend dependencies</td>
            </tr>
            <tr>
                <td><code>npm test</code></td>
                <td>Run test suite</td>
            </tr>
        </table>

        <h3>12.2 Quick Start Commands</h3>

        <pre><code><span class="comment"># 1. Clone and install dependencies</span>
npm install
npm run server:install

<span class="comment"># 2. Configure environment</span>
cp server/.env.example server/.env
<span class="comment"># Edit server/.env and set JWT_SECRET</span>

<span class="comment"># 3. Run the application</span>
npm run dev:all

<span class="comment"># 4. Access the application</span>
<span class="comment"># Frontend: http://localhost:5173</span>
<span class="comment"># Backend:  http://localhost:3001</span></code></pre>

        <h3>12.3 Implemented Features (v1.1)</h3>

        <div class="info-box" style="background: #e8f5e9; border-left-color: #2e7d32;">
            <h4>âœ… Recently Added Features</h4>
            <ul>
                <li><strong>Multi-language Support (i18n)</strong> - 10 Indian regional languages: English, Hindi, Marathi, Telugu, Tamil, Kannada, Bengali, Gujarati, Punjabi, Malayalam</li>
                <li><strong>Crops to Avoid Analysis</strong> - Risk assessment showing crops farmers should avoid based on soil, weather, season, market, and profit margin analysis</li>
                <li><strong>Google OAuth</strong> - Sign in with any Google account via Firebase Authentication</li>
                <li><strong>State-to-Language Mapping</strong> - Automatic language suggestions based on farmer's state</li>
                <li><strong>Risk Level Indicators</strong> - High/Medium risk badges for avoided crops</li>
                <li><strong>Alternative Crop Suggestions</strong> - Recommends safer alternatives for risky crops</li>
            </ul>
        </div>

        <h3>12.4 Algorithm Documentation Update (v1.2)</h3>

        <div class="success-box">
            <h4>âœ… Documentation Updates - February 2026</h4>
            <ul>
                <li><strong>Algorithm Name Documented</strong> - Weighted Multi-Factor Scoring Algorithm (WMFS)</li>
                <li><strong>Complete WMFS Process Flow</strong> - 5-phase recommendation process with detailed flowcharts</li>
                <li><strong>Scoring Formula Details</strong> - Budget (30%), Profit (30%), Yield (20%), ROI (20%) weights</li>
                <li><strong>Farming Type Scoring</strong> - Individual scoring algorithms for 5 farming types</li>
                <li><strong>Companion Crop Algorithm</strong> - Intercropping compatibility and score boosting logic</li>
                <li><strong>Risk Assessment Algorithm</strong> - 7 risk factors with estimated loss calculations</li>
                <li><strong>Live Price Integration</strong> - AGMARKNET API with 30-minute caching strategy</li>
                <li><strong>Economic Calculation Formulas</strong> - Detailed cost/revenue/profit formulas</li>
            </ul>
        </div>

        <h3>12.5 Future Enhancements</h3>

        <div class="info-box">
            <h4>Planned Features</h4>
            <ul>
                <li>Rate limiting with express-rate-limit</li>
                <li>Input validation with express-validator</li>
                <li>Security headers with helmet.js</li>
                <li>Email verification system</li>
                <li>Password reset functionality</li>
                <li>PostgreSQL migration for scalability</li>
                <li>Redis caching layer</li>
                <li>WebSocket real-time updates</li>
                <li>Admin panel for data management</li>
                <li>Mobile app with React Native</li>
                <li>Offline mode (PWA)</li>
            </ul>
        </div>

        <!-- Footer -->
        <div style="margin-top: 60px; padding-top: 20px; border-top: 2px solid #ddd; text-align: center; color: #666;">
            <p><strong>Crop Recommender System - Complete Documentation</strong></p>
            <p>Version 1.2 | February 2026</p>
            <p>Full-Stack Application: React + Node.js + Express + SQLite + Firebase</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Algorithm: WMFS (Weighted Multi-Factor Scoring) | Features: Multi-language | Crops to Avoid | Google OAuth</p>
        </div>
    </div>
</body>
</html>
